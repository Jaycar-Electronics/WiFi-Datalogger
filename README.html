<!-- start landing page area -->
<style type="text/css">
    @import url('https://fonts.googleapis.com/css?family=Coming+Soon');
    @import url('https://fonts.googleapis.com/css?family=Roboto+Mono');

    body {
        background-color: #ffffff;
    }

    .arduinopage {
        font-size: 14px;
        padding: 20px;
        background-color: #ffffff;
        margin-left: 10px;
        margin-top: 50px;
        width: 890px;
        padding-bottom: 150px;
    }
    .arduinopage a {
        color: #103570;
    }
    table {
        border-collapse: collapse;
        margin-top: 15px;
        margin-bottom: 15px;
    }
    .arduinopage pre { 
        white-space: pre;
    }
    .lpstandard td {
        border: 1px solid #cccccc;
    }

    .majorheading {
        font-family: 'Coming Soon', Arial, sans-serif !important;
        font-size: 30px;
        line-height: 55px;
        color: #263a43;
        font-weight: bold;
        text-align: center;
    }
    .lpheading {
        font-family: 'Coming Soon', Arial, sans-serif !important;
        font-size: 20px;
        font-weight: bold;
        color: #ff8200;
    }
    img.arduinoimg {
        max-width: 790px;
        margin-left: auto;
        margin-right: auto;
        display: block;
        margin-top: 15px;
        margin-bottom: 15px;
    }
    .sourceLine,
    .sourceCode,
    .arduinopage span{
        font-family: 'Roboto Mono', monospace !important;
    }

    code {
        font-family: 'Roboto Mono', monospace !important;
        border-radius: 3px;
    }

    code:not(.sourceCode) {
        /*background-color: #F1EBD9;*/
        padding: 2px 3px;
    }

    .arduinopage ul {
        margin-block-start: 0.5em !important;
        margin-block-end: 0.5em !important;
        margin-inline-start: 0px !important;
        margin-inline-end: 0px !important;
        padding-inline-start: 40px !important;
        display: block;
        list-style-type: disc;
    }
    .arduinopage ul li {
        list-style-type: disc;
    }

    code.sourceCode {
        border: dotted 1px #848484;
        background-color: #F1EBD9 !important;
        font-size: 15px !important;
        margin: 0px auto 20px auto !important;
        overflow-x: scroll;
        overflow-y: auto;
        width: 95%;
    }


    .arduinopage,
    table.rednav {
        -webkit-box-shadow: 0px 3px 30px 0px rgba(0, 0, 0, 0.65);
        -moz-box-shadow: 0px 3px 30px 0px rgba(0, 0, 0, 0.65);
        box-shadow: 0px 3px 30px 0px rgba(0, 0, 0, 0.65);
    }

    @media (max-width: 1000px) {
        .arduinopage {
            width: 100%;
            margin-left: 0;
            box-sizing: border-box;
            -moz-box-sizing: border-box;
            -webkit-box-sizing: border-box;
            -ms-box-sizing: border-box;
            padding: 8px;
        }

        .arduinopage img {
            width: 100%;
            max-width: 600px;
        }

        .arduinopage iframe {
            width: 100%;
            height: 200px;
            margin: 20px 0;
        }
    }
</style>

<link rel="stylesheet" href="https://www.jaycar.com.au/medias/sys_master/9126545424414/foundation.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/styles/atom-one-light.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/highlight.min.js"></script>
<script>
hljs.initHighlightingOnLoad();
hljs.registerLanguage("plaintext",function(e){return{disableAutodetect:!0}});
</script>

<div class="arduinopage">
<h1 class="majorheading">WiFi Datalogger</h1>
<p>Use ESP8266 and IFTTT Services to control the cloud</p>
<table>
<thead>
<tr class="header">
<th>Input</th>
<th>Output</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Sensors</td>
<td>Graphs</td>
</tr>
</tbody>
</table>
<!-- TOC -->

<ul>
<li><a href="#wifi-datalogger">WiFi Datalogger</a>
<ul>
<li><a href="#bill-of-materials">Bill of materials</a></li>
<li><a href="#software--libraries">Software &amp; Libraries</a></li>
<li><a href="#system-overview">System overview</a>
<ul>
<li><a href="#circuit-connections">Circuit Connections</a></li>
<li><a href="#ifttt-setup">IFTTT Setup</a></li>
</ul></li>
<li><a href="#sensors">Sensors</a></li>
<li><a href="#integration">Integration</a></li>
<li><a href="#use">Use</a></li>
<li><a href="#future-improvements">Future improvements</a></li>
<li><a href="#further-reading">Further reading</a></li>
</ul></li>
</ul>
<!-- /TOC -->

<h2 class="lpheading">Bill of materials</h2>
<table>
<thead>
<tr class="header">
<th>Qty</th>
<th>Code</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td><a href="/p/XC3802">XC3802</a></td>
<td>ESP8266 board</td>
</tr>
<tr class="even">
<td>1</td>
<td><a href="/p/ZK8868">ZK8868</a></td>
<td>Microchip MCP3008 8ch ADC</td>
</tr>
<tr class="odd">
<td>1</td>
<td><a href="/p/HP9550">HP9550</a></td>
<td>Prototyping board</td>
</tr>
<tr class="even">
<td>1</td>
<td><a href="/p/WC6026">WC6026</a></td>
<td>Socket socket leads</td>
</tr>
<tr class="odd">
<td>1</td>
<td><a href="/p/XC4494">XC4494</a></td>
<td>Temperature sensor</td>
</tr>
<tr class="even">
<td>1</td>
<td><a href="/p/XC4604">XC4604</a></td>
<td>Soil moisture sensor</td>
</tr>
<tr class="odd">
<td>1</td>
<td><a href="/p/RD3485">RD3485</a></td>
<td>Light dependent resistor</td>
</tr>
<tr class="even">
<td>1</td>
<td><a href="/p/HM3211">HM3211</a></td>
<td>Header pins</td>
</tr>
<tr class="odd">
<td>1</td>
<td><a href="/p/RR0596">RR0596</a></td>
<td>10k resistors</td>
</tr>
</tbody>
</table>
<h2 class="lpheading">Software &amp; Libraries</h2>
<p>This project uses the IFTTT service, found at</p>
<ul>
<li><a href="https://ifttt.com/discover">https://ifttt.com/discover</a></li>
</ul>
<p>It also uses the following arduino library:</p>
<table>
<thead>
<tr class="header">
<th>Library</th>
<th>Author</th>
<th>Version</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ArduinoJson</td>
<td>Benoit Blanchon</td>
<td>6.11.2</td>
</tr>
</tbody>
</table>
<h2 class="lpheading">System overview</h2>
<p><img src="images/system.png" class="arduinoimg" /></p>
<p>Luckily for us, the heavy lifting is done through the IFTTT service, which makes things a lot simplier. IFTTT Provides a url that we can access with our ESP8266 and send data to; When the data is uploaded, IFTTT can then apply it to any other serivce that you want; in our case we will put it on a <a href="https://www.google.com/sheets/about/">Google Sheets</a> spreadsheet.</p>
<p>The XC3802 board only has 1 analog pin, up to 1 volt, which is pretty insufficient for most cases, so we use the MCP3008 chip (<a href="/p/ZK8868">ZK8868</a>) as our Analog to Digital converter (8 channels, 5V, 10bit resolution - beefy!) and receive the information on the ESP to send to IFTTT.</p>
<p>One limitation of the free IFTTT service is that you can only upload 3 values at a time, but that can be overcome by the ArduinoJson library or by doing some <a href="https://codeburst.io/your-guide-to-bit-manipulation-48e7692f314a">bit manipulation</a></p>
<h3 class="lpheading">Circuit Connections</h3>
<p>The general connections are very simply connecting the MCP to the ESP.</p>
<p><img src="images/schematic.png" class="arduinoimg" /></p>
<p>Looking at the MCP datasheet, the entire left side of the chip are the analog channels, and the right side of the chip has our SPI connections on pins 10,11,12 and 13, making the wiring very easy.</p>
<table>
<thead>
<tr class="header">
<th>MCP3008</th>
<th>XC3802</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>10</td>
<td>D8</td>
<td>Chip select</td>
</tr>
<tr class="even">
<td>11</td>
<td>D7</td>
<td>SPI MoSi</td>
</tr>
<tr class="odd">
<td>12</td>
<td>D6</td>
<td>SPI MiSo</td>
</tr>
<tr class="even">
<td>13</td>
<td>D5</td>
<td>SPI CLK</td>
</tr>
</tbody>
</table>
<p>Laying it out on the circuit board makes for easy work</p>
<p><img src="images/layout.jpg" class="arduinoimg" /></p>
<p>Here we used the headers from the pack of the XC3802, and broke the 28pin header into the 3x8 grid next to the chip, looking under the board shows why:</p>
<p><img src="images/underside.jpg" class="arduinoimg" /></p>
<p>With the ease of this HP9509 prototyping board, the 3 pins next to the chip's position has 2 rails and the chip leg connection. This makes for super simple work to connect up the power and ground rails across the whole grid so that every sensor has it's own +5V and GND.</p>
<p>We also bridge the <code>AGND</code> and <code>Vref</code> of the MCP3008 to the Ground and 5V rails respectively; as we want the full 5V range to be available on the ADC conversion.</p>
<p>Then Bridge the 5V and GND from the XC3802 board to the correct rails. Make sure you know which one is which, as it is reversed when you look at it from the underside!</p>
<h3 class="lpheading">IFTTT Setup</h3>
<p>IFTT is easy to set up; feel free to skip this part if you're comfortable. We need to make a new applet that connects the google sheet service to the "Maker" Service which provides our URL for us to send data to.</p>
<p>Start with creating an account and logging in, then press "new applet"</p>
<p><img src="images/getstarted.png" class="arduinoimg" /></p>
<p>First click the blue "This" to create the first part of our setup, which is "receive a web request" - as in: <em>"WHEN we receive a web request ( coming from our ESP) THEN ..."</em></p>
<p><img src="images/createapplet.png" class="arduinoimg" /></p>
<p><img src="images/choosetrigger.png" class="arduinoimg" /></p>
<p>You can call the event anything you want, ours will just be <code>log_minute</code></p>
<p><img src="images/setname.png" class="arduinoimg" /></p>
<p>Then we click on the blue "That" to set up the result of our trigger;</p>
<p><img src="images/thenthat.png" class="arduinoimg" /></p>
<p>You can see there are many services that you are able to use; including gmail and our google-sheets. <img src="images/actionservices.png" class="arduinoimg" /></p>
<p>We just want to "add row to spreadsheet" for our purposes; This is just a simple datalogging tutorial project; you can really do a lot more with this service.</p>
<p><img src="images/addrow.png" class="arduinoimg" /></p>
<p>Once that service is made, you're finished, you will just need your webhooks key to put in the arduino code so that the ESP can trigger the right event you want.</p>
<h2 class="lpheading">Sensors</h2>
<p>Each of the sensors should have a <code>S</code> as well as a <code>-</code> and <code>+</code> - use this to connect to the header grid, noting which pin is positive. It might be best to mark which row has positive and which has negative so that you do not get confused down the track.</p>
<p>The only exception is the LDR which needs a bit more manual set up. This is a simple <a href="https://en.wikipedia.org/wiki/Voltage_divider">Voltage Divider</a> circuit, with one of the resistors being the LDR.</p>
<p>We used 3 leads to solder between the resistor and the LDR,</p>
<p><img src="images/ldr1.jpg" class="arduinoimg" /> <img src="images/ldr2.jpg" class="arduinoimg" /></p>
<h2 class="lpheading">Integration</h2>
<!-- How to join it all together -->

<p>Once you have the circuit made and ready to upload data, you need to first check your webhooks in IFTTT to get the correct key and event name.</p>
<p>Firstly, Click on your services tab, then click on webhooks.</p>
<p><img src="images/makewebhooks.png" class="arduinoimg" /></p>
<p>In the webhooks service, you can find settings in the top right, which will provide you with a Account URL. The final part of this URL is your KEY.</p>
<p><img src="images/webhookkey.png" class="arduinoimg" /></p>
<p>In the datalog.ino, you can see the URL which has <code>EVENT_NAME_HERE</code> and <code>YOUR_KEY_HERE</code> - replace these with what your event name and key is, so that it is all one string variable.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode c"><code class="sourceCode c"><a class="sourceLine" id="cb1-1" title="1"><span class="dt">const</span> <span class="dt">char</span>* URL = <span class="st">&quot;http://maker.ifttt.com/trigger/EVENT_NAME_HERE/with/key/YOUR_KEY_HERE&quot;</span>;</a>
<a class="sourceLine" id="cb1-2" title="2"></a>
<a class="sourceLine" id="cb1-3" title="3"><span class="co">//should become -&gt;</span></a>
<a class="sourceLine" id="cb1-4" title="4"></a>
<a class="sourceLine" id="cb1-5" title="5"><span class="dt">const</span> <span class="dt">char</span>* URL = <span class="st">&quot;http://maker.ifttt.com/trigger/log_minute/with/key/asdf1234qwetyuiopetcexample&quot;</span>;</a></code></pre></div>
<p>There is also the variables for your WiFi SSID and password as well.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode c"><code class="sourceCode c"><a class="sourceLine" id="cb2-1" title="1"><span class="dt">const</span> <span class="dt">char</span>* WIFI_SSID = <span class="st">&quot;wifiName&quot;</span>;</a>
<a class="sourceLine" id="cb2-2" title="2"><span class="dt">const</span> <span class="dt">char</span>* WIFI_PASS = <span class="st">&quot;wifiPassword&quot;</span>;</a></code></pre></div>
<p>Connect up the ESP, change the board type to WeMos D1, and press upload. You can open the Serial monitor and view what it is doing to debug any issues.</p>
<h2 class="lpheading">Use</h2>
<p>Once the data is uploading you can use it for any purpose. You could connect different soil / moisture / windspeed type of sensors and make your own weather logger. The information is transmitted and stored proportional to the voltage on the MCP3008's pins, between 0V and 5V.</p>
<p><img src="images/evidence.png" class="arduinoimg" /></p>
<p>When in google sheets, you would be able to select the data and produce charts and graphs over time, and other statistical work.</p>
<h2 class="lpheading">Future improvements</h2>
<p>Through IFTTT you can easily connect this service to any other out there; Gmail is an obvious example, but how about notifying your rpi server?</p>
<p>Got more ideas with what we can add to it? Submit a github issue and get collaborating!</p>
<h2 class="lpheading">Further reading</h2>
<p>Please note, Jaycar does not support nor endorse any of the below links, nor offers any guarentee of their quality or suitability for your needs.</p>
<ul>
<li><a href="https://arduinojson.org/">https://arduinojson.org/</a></li>
<li><a href="https://www.w3schools.com/whatis/whatis_json.asp">https://www.w3schools.com/whatis/whatis_json.asp</a></li>
<li><a href="https://ifttt.com/about">https://ifttt.com/about</a></li>
<li><a href="https://searchmicroservices.techtarget.com/definition/RESTful-API">https://searchmicroservices.techtarget.com/definition/RESTful-API</a></li>
<li><a href="http://www.robert-drummond.com/2013/05/08/how-to-build-a-restful-web-api-on-a-raspberry-pi-in-javascript-2/">http://www.robert-drummond.com/2013/05/08/how-to-build-a-restful-web-api-on-a-raspberry-pi-in-javascript-2/</a></li>
</ul>
</div>